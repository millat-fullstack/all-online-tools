<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Speech to Text Converter | Voice & Audio File Transcription</title>
<link rel="stylesheet" href="../css/home.css">
<link rel="stylesheet" href="../css/suggested.css">
<style>
/* --- Shared site look (matches your other tools) --- */
body {
  font-family: 'Inter', sans-serif;
  background:#f8f6fb;
  color:#2c2c2c;
  margin:0;
  padding:0;
  min-height:100vh;
}
.page-container {
  padding:40px;
  max-width:900px;
  margin:50px auto;
  background:#fff;
  border-radius:12px;
  box-shadow:0 4px 20px rgba(0,0,0,0.1);
  text-align:center;
  box-sizing:border-box;
  position:relative;
  overflow:hidden;
  z-index:1;
}
h1{color:#6b4de6;margin-bottom:10px;}
.lead{color:#555;margin-bottom:25px;}
.controls{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-bottom:20px;}
select,button,input[type=file]{
  padding:10px 16px;
  border:1px solid #ddd;
  border-radius:8px;
  background:#f8f6fb;
  cursor:pointer;
  font-weight:600;
}
button:hover{background:#ece7fa;}
.status{margin-bottom:12px;color:#6b4de6;font-weight:600;}
.transcript{
  margin-top:12px;
  background:#fafafa;
  border:1px solid #eee;
  padding:16px;
  border-radius:8px;
  min-height:160px;
  white-space:pre-wrap;
  text-align:left;
  overflow-y:auto;
}
.actions{margin-top:16px;display:flex;flex-wrap:wrap;gap:10px;justify-content:center;}
.note{margin-top:16px;color:#666;font-size:0.92rem;}
</style>
</head>
<body>
<div id="header"></div>

<div class="page-container">
  <h1>üéôÔ∏è Speech ‚Üí Text Converter</h1>
  <p class="lead">Dictate live or upload an audio file to convert it to editable text ‚Äì all in your browser.</p>

  <!-- ===== Live Microphone Section ===== -->
  <div class="controls">
    <select id="langSelect">
      <option value="en-US">English (US)</option>
      <option value="en-GB">English (UK)</option>
      <option value="bn-BD">Bengali (Bangladesh)</option>
      <option value="hi-IN">Hindi (India)</option>
      <option value="ko-KR">Korean</option>
      <option value="es-ES">Spanish</option>
    </select>
    <button id="startBtn">üé§ Start Mic</button>
    <button id="stopBtn">‚èπ Stop</button>
    <button id="resetBtn">‚ôªÔ∏è Clear</button>
  </div>

  <!-- ===== Audio Upload Section ===== -->
  <div class="controls">
    <input type="file" id="audioInput" accept="audio/*">
    <button id="fileTranscribeBtn">Convert Uploaded Audio</button>
  </div>

  <div class="status" id="status">Status: Idle</div>
  <div id="transcript" class="transcript" contenteditable="true"></div>

  <div class="actions">
    <button id="copyBtn">Copy</button>
    <button id="downloadBtn">Download .txt</button>
    <button id="pasteBtn">Paste Clipboard</button>
  </div>

  <p class="note">Live mode uses your browser‚Äôs <b>Web Speech API</b>.  
  File mode uses an <b>open-source Vosk model</b> and runs completely in-browser (no server upload).</p>
</div>

<!-- ====== Logic ====== -->
<script type="module">
import initVosk from "https://unpkg.com/vosk-browser/dist/vosk.js"; // you can host locally

const statusEl = document.getElementById('status');
const transcriptEl = document.getElementById('transcript');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const resetBtn = document.getElementById('resetBtn');
const langSelect = document.getElementById('langSelect');
const copyBtn = document.getElementById('copyBtn');
const downloadBtn = document.getElementById('downloadBtn');
const pasteBtn = document.getElementById('pasteBtn');
const audioInput = document.getElementById('audioInput');
const fileBtn = document.getElementById('fileTranscribeBtn');

let recognition, recognizing=false, finalTranscript="";

/* ===== Live Speech via Web Speech API ===== */
window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition || null;
if (!window.SpeechRecognition){
  startBtn.disabled = stopBtn.disabled = true;
  statusEl.textContent = "Status: Browser does not support Web Speech API.";
}else{
  recognition = new window.SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.lang = langSelect.value;

  recognition.onstart = ()=>{recognizing=true;statusEl.textContent="Status: Listening‚Ä¶";};
  recognition.onend   = ()=>{recognizing=false;statusEl.textContent="Status: Stopped";};
  recognition.onresult = e=>{
    let interim="";
    for(let i=e.resultIndex;i<e.results.length;++i){
      const txt = e.results[i][0].transcript;
      if(e.results[i].isFinal){ finalTranscript += txt; }
      else { interim += txt; }
    }
    transcriptEl.textContent = (finalTranscript + " " + interim).trim();
    transcriptEl.scrollTop = transcriptEl.scrollHeight;
  };
}

startBtn.onclick = ()=>{
  if (!recognition) return;
  recognition.lang = langSelect.value;
  finalTranscript = transcriptEl.textContent || "";
  try{recognition.start();}catch(e){}
};
stopBtn.onclick = ()=> recognition && recognition.stop();
resetBtn.onclick = ()=>{
  finalTranscript="";
  transcriptEl.textContent="";
  statusEl.textContent="Status: Idle";
  if(recognition && recognizing) recognition.stop();
};

/* ===== File Upload using Vosk ===== */
let voskModel;
async function ensureVosk(){
  if (voskModel) return voskModel;
  statusEl.textContent="Loading Vosk model (~50 MB)‚Ä¶";
  const vosk = await initVosk();
  // host a small English model in /vosk-model-small-en-us-0.15
  voskModel = await vosk.createModel("vosk-model-small-en-us-0.15");
  statusEl.textContent="Model loaded. Ready to transcribe.";
  return voskModel;
}

fileBtn.onclick = async ()=>{
  const file = audioInput.files[0];
  if(!file){alert("Please select an audio file first.");return;}
  const model = await ensureVosk();
  statusEl.textContent="Processing audio‚Ä¶";
  const arrayBuffer = await file.arrayBuffer();
  const {transcript} = await model.recognize(arrayBuffer);
  transcriptEl.textContent = transcript;
  finalTranscript = transcript;
  statusEl.textContent="File transcription complete.";
};

/* ===== Utility Buttons ===== */
copyBtn.onclick = async ()=>{
  const text = transcriptEl.textContent.trim();
  if(!text) return alert("Nothing to copy");
  await navigator.clipboard.writeText(text);
  copyBtn.textContent="Copied ‚úì";
  setTimeout(()=>copyBtn.textContent="Copy",900);
};
downloadBtn.onclick = ()=>{
  const text = transcriptEl.textContent.trim();
  if(!text) return alert("Nothing to download");
  const blob = new Blob([text],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="transcript.txt";
  a.click();
  URL.revokeObjectURL(a.href);
};
pasteBtn.onclick = async ()=>{
  try{
    const text = await navigator.clipboard.readText();
    if(text) transcriptEl.textContent += (transcriptEl.textContent?"\n":"")+text;
  }catch(e){alert("Clipboard permission denied");}
};
</script>

<!-- Extra Sections -->

<section id="suggested-tools">
  <h2>Suggested Tools</h2>
  <div class="suggested-list"></div>
</section>

<script src="../js/suggested.js"></script>


  <div id="footer"></div>
<script src="../js/include.js"></script>

</body>
</html>
